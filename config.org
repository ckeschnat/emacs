#+SETUPFILE: themes/theme-readtheorg-local.setup
#+OPTIONS: html-postamble:nil num:nil
#+FILETAGS: emacs
#+TITLE: Emacs config
* Introduction

Headings tagged "CANCELLED" will not be tangled.

Install fonts from fonts folder.
* Startup
#+BEGIN_SRC emacs-lisp
  ;; Use a hook so the message doesn't get clobbered by other messages.
  (add-hook 'emacs-startup-hook
            (lambda ()
              (message "Emacs ready in %s with %d garbage collections."
                       (format "%.2f seconds"
                               (float-time
                                (time-subtract after-init-time before-init-time)))
                       gcs-done)))

#+END_SRC
* Gc and startup
https://www.reddit.com/r/emacs/comments/55ork0/is_emacs_251_noticeably_slower_than_245_on_windows/d8cmm7v/

http://bling.github.io/blog/2016/01/18/why-are-you-changing-gc-cons-threshold/

#+BEGIN_SRC emacs-lisp
  (defun my-minibuffer-setup-hook ()
    (setq gc-cons-threshold most-positive-fixnum))

  (defun my-minibuffer-exit-hook ()
    (setq gc-cons-threshold (* 63 1024 1024)))

  (add-hook 'minibuffer-setup-hook #'my-minibuffer-setup-hook)
  (add-hook 'minibuffer-exit-hook #'my-minibuffer-exit-hook)

  (setq gc-cons-threshold most-positive-fixnum)

  (add-hook 'after-init-hook #'(lambda ()
                                 ;; restore after startup
                                (setq gc-cons-threshold (* 63 1024 1024))))

  (setq gc-cons-percentage 0.5)
  (run-with-idle-timer 5 t #'garbage-collect)
  (setq garbage-collection-messages t)
#+END_SRC

https://ambrevar.xyz/emacs2/
#+BEGIN_SRC emacs-lisp
  ;;; Temporarily disable the file name handler.
  (setq default-file-name-handler-alist file-name-handler-alist)
  (setq file-name-handler-alist nil)
  (defun ambrevar/reset-file-name-handler-alist ()
    (setq file-name-handler-alist
      (append default-file-name-handler-alist
          file-name-handler-alist))
    (cl-delete-duplicates file-name-handler-alist :test 'equal))
  (add-hook 'after-init-hook #'ambrevar/reset-file-name-handler-alist)
#+END_SRC
* OS and Hostname
Functions to determine which machine I'm on

https://karl-voit.at/2017/02/11/my-system-is-foobar/

#+BEGIN_SRC emacs-lisp
  ;; Check if system is Darwin/macOS
  (defun my-system-type-is-darwin ()
    "Return true if system is darwin-based (Mac OS X)"
    (string-equal system-type "darwin"))

  ;; Check if system is Microsoft Windows
  (defun my-system-type-is-windows ()
    "Return true if system is Windows-based (at least up to Win7)"
    (string-equal system-type "windows-nt"))

  ;; Check if system is GNU/Linux
  (defun my-system-type-is-gnu ()
    "Return true if system is GNU/Linux-based"
    (string-equal system-type "gnu/linux"))

  ;; Check if the hostname is mynotebook
  (defun my-system-is-mypc ()
    "Return true if the system we are running on is mynotebook"
    (string-equal (system-name) "BEZEL"))

  ;; Check if the hostname is mydesktop
  (defun my-system-is-myoldworkpc ()
    "Return true if the system we are running on is mydesktop"
    (string-equal (system-name) "P1WN0259"))

  ;; Check if the hostname is mydesktop
  (defun my-system-is-myworkpc ()
    "Return true if the system we are running on is mydesktop"
    (string-equal (system-name) "P1WN0669"))
#+END_SRC
* Packages
#+BEGIN_SRC emacs-lisp
  ;; Package configs
  (require 'package)
  (setq package-enable-at-startup nil)
  (setq package-archives '(("org"   . "http://orgmode.org/elpa/")
                           ("gnu"   . "http://elpa.gnu.org/packages/")
                           ("melpa" . "https://melpa.org/packages/")))
  (package-initialize)

  ;; Bootstrap `use-package`
  (unless (package-installed-p 'use-package)
    (package-refresh-contents)
    (package-install 'use-package))
#+END_SRC
* use-package
#+BEGIN_SRC emacs-lisp
  (require 'use-package)
  (setq use-package-always-ensure t)
  (setq use-package-always-defer t)
#+END_SRC
* Profiling
#+BEGIN_SRC emacs-lisp
  (use-package esup)
#+END_SRC
* UI
https://huytd.github.io/emacs-from-scratch.html

https://superuser.com/questions/313398/how-to-prevent-the-symbols-function-definition-is-void-error-when-running-em
*** Misc
#+BEGIN_SRC emacs-lisp
  ;; Minimal UI
  (when (display-graphic-p)
    (progn
      (scroll-bar-mode -1)
      (tool-bar-mode   -1)))
  (tooltip-mode    -1)
  (menu-bar-mode   -1)
  (setq inhibit-splash-screen t)
#+END_SRC
*** Font
Set Symbola as fallback font to display unicode characters.
#+BEGIN_SRC emacs-lisp
  (set-fontset-font "fontset-default" nil
    (font-spec :size 20 :name "Symbola"))

  (add-to-list 'default-frame-alist '(font . "Liberation Mono"))
  (add-to-list 'initial-frame-alist '(fullscreen . maximized))
  (add-to-list 'default-frame-alist '(fullscreen . fullheight))
#+END_SRC
*** Theme
#+BEGIN_SRC emacs-lisp :tangle no
  ;; Theme
  (add-to-list 'custom-theme-load-path "~/.emacs.d/themes/")
    (setq zenburn-override-colors-alist '(
                                          ("zenburn-bg-05" . "#131818")
                                          ("zenburn-bg-1" . "#6A714A")
                                          ))
  (load-theme 'zenburn t)

#+END_SRC

#+BEGIN_SRC emacs-lisp
  (add-to-list 'load-path "~/.emacs.d/elpa/doom-themes-20181101.218/")
  (use-package doom-themes
    :defer nil
    :config
    (load-theme 'doom-one t))
#+END_SRC

https://github.com/jasonm23/emacs-select-themes
#+BEGIN_SRC emacs-lisp
  (defun select-themes (theme)
    "Interactively select a THEME, from the available custom themes.
  You can also select '*Emacs default*' to return to Emacs default theme.
  Note: multiple enabled themes cause Emacs to slow down, so we
  disable them before selecting the new theme."
    (interactive (list (completing-read "Select theme: "
                                  (sort (custom-available-themes) 'string<)
                                  nil nil nil nil
                                  "*Emacs default*")))
    (mapc 'disable-theme custom-enabled-themes)
    (unless (string= "*Emacs default*" theme)
      (load-theme (intern-soft theme))))

  (provide 'select-themes)
#+END_SRC

#+BEGIN_SRC emacs-lisp
  (use-package all-the-icons)
  (use-package doom-modeline
    :ensure t
    :defer t
    :hook (after-init . doom-modeline-init))
#+END_SRC
* Misc
A lot of this is from https://github.com/hrs/sensible-defaults.el/blob/master/sensible-defaults.el
*** Cleanup whitespace
#+BEGIN_SRC emacs-lisp
  (setq show-trailing-whitespace t)
  (add-hook 'before-save-hook 'whitespace-cleanup)
#+END_SRC
*** Follow symlinks
#+BEGIN_SRC emacs-lisp
  (setq vc-follow-symlinks t)
#+END_SRC
*** Scipts auto executable
#+BEGIN_SRC emacs-lisp
  (add-hook 'after-save-hook 'executable-make-buffer-file-executable-if-script-p)
#+END_SRC
*** CamelCase-Movement
#+BEGIN_SRC emacs-lisp
  (add-hook 'prog-mode-hook 'subword-mode)
#+END_SRC
*** Final newline
If you save a file that doesn't end with a newline,
automatically append one.
#+BEGIN_SRC emacs-lisp
  (setq require-final-newline t)
#+END_SRC
*** Confirm kill emacs
Ask if you're sure that you want to close Emacs.
#+BEGIN_SRC emacs-lisp
  (setq confirm-kill-emacs 'y-or-n-p)
#+END_SRC
*** Visible bell
When you perform a problematic operation, flash the screen
instead of ringing the terminal bell.
#+BEGIN_SRC emacs-lisp
  (setq visible-bell t)
#+END_SRC
*** Create directories
When saving a file in a directory that doesn't exist, offer
to (recursively) create the file's parent directories.
#+BEGIN_SRC emacs-lisp
  (add-hook 'before-save-hook
              (lambda ()
                (when buffer-file-name
                  (let ((dir (file-name-directory buffer-file-name)))
                    (when (and (not (file-exists-p dir))
                               (y-or-n-p (format "Directory %s does not exist. Create it?" dir)))
  (make-directory dir t))))))
#+END_SRC
*** Auto reload
When something changes a file, automatically refresh the
buffer containing that file so they can't get out of sync.
#+BEGIN_SRC emacs-lisp
  (global-auto-revert-mode t)
#+END_SRC
*** Paths
#+BEGIN_SRC emacs-lisp
  (setenv "PATH" (concat "C:\\msys64\\usr\\bin;" "C:\\msys64\\mingw64\\bin;" "C:\\texlive\\2018\\bin\\win32;" "w:\\handmade\\misc;" (getenv "PATH")))
#+END_SRC
*** Encoding
See [[https://www.masteringemacs.org/article/working-coding-systems-unicode-emacs][masteringemacs]] and [[https://zhangda.wordpress.com/2016/02/15/configurations-for-beautifying-emacs-org-mode/]]
#+BEGIN_SRC emacs-lisp
  ;; disable CJK coding/encoding (Chinese/Japanese/Korean characters)
  (setq utf-translate-cjk-mode nil)

  (set-language-environment 'utf-8)
  (setq locale-coding-system 'utf-8)

  ;; set the default encoding system
  (prefer-coding-system 'utf-8)
  (setq default-file-name-coding-system 'utf-8)
  (set-default-coding-systems 'utf-8)
  (set-terminal-coding-system 'utf-8)
  (set-keyboard-coding-system 'utf-8)
  ;; backwards compatibility as default-buffer-file-coding-system
  ;; is deprecated in 23.2.
  (if (boundp buffer-file-coding-system)
      (setq buffer-file-coding-system 'utf-8)
    (setq default-buffer-file-coding-system 'utf-8))

  ;; Treat clipboard input as UTF-8 string first; compound text next, etc.
  (setq x-select-request-type '(UTF8_STRING COMPOUND_TEXT TEXT STRING))
#+END_SRC
*** Customize
#+BEGIN_SRC emacs-lisp
  (setq custom-file "~/.emacs.d/custom.el")
  (load custom-file 'noerror)
#+END_SRC
*** Help
#+BEGIN_SRC emacs-lisp
  (setq help-window-select t)
#+END_SRC
*** Parens
#+BEGIN_SRC emacs-lisp
  ;; Show matching parens
  (setq show-paren-delay 0)
  (show-paren-mode 1)
#+END_SRC
*** Change "yes or no" to "y or n"
#+BEGIN_SRC emacs-lisp
  (fset 'yes-or-no-p 'y-or-n-p)
#+END_SRC
*** Backup, autosaves and lock files
#+BEGIN_SRC emacs-lisp
  ;; Set backup directory
  (setq backup-directory-alist '(("." . "~/.emacs.d/backups")))

  (setq delete-old-versions -1)
  (setq version-control t)
  (setq vc-make-backup-files t)
  (setq auto-save-file-name-transforms '((".*" "~/.emacs.d/auto-save-list/" t)))

  ;; No lock files
  (setq create-lockfiles nil)
#+END_SRC
*** History
#+BEGIN_SRC emacs-lisp
  (setq savehist-file "~/.emacs.d/savehist")
  (savehist-mode 1)
  (setq history-length t)
  (setq history-delete-duplicates t)
  (setq savehist-save-minibuffer-history 1)
  (setq savehist-additional-variables
        '(kill-ring
          search-ring
          regexp-search-ring))
#+END_SRC
*** Time in modeline
#+BEGIN_SRC emacs-lisp
  (display-time-mode 1)
#+END_SRC
*** Sentences end with a single space
#+BEGIN_SRC emacs-lisp
  (setq sentence-end-double-space nil)
#+END_SRC
*** Winner
#+BEGIN_SRC emacs-lisp
  (winner-mode 1)
#+END_SRC
*** persistent undo
#+BEGIN_SRC emacs-lisp
  (setq undo-tree-auto-save-history t)
  (setq undo-tree-history-directory-alist '(("." . "~/.emacs.d/undo")))
#+END_SRC
*** Undo tree mode - visualize your undos and branches

People often struggle with the Emacs undo model, where there's really no concept of "redo" - you simply undo the undo.
#
This lets you use =C-x u= (=undo-tree-visualize=) to visually walk through the changes you've made, undo back to a certain point (or redo), and go down different branches.

#+BEGIN_SRC emacs-lisp
  (use-package undo-tree
    :diminish undo-tree-mode
    :config
    (progn
      (global-undo-tree-mode)
      (setq undo-tree-visualizer-timestamps t)
      (setq undo-tree-visualizer-diff t))

    (general-define-key
      :states '(normal visual insert emacs)
      :prefix "SPC"
      :non-normal-prefix "M-SPC"
      "u"  '(:ignore t :which-key "Undo")
      "uv" '(undo-tree-visualize :which-key "Visualize")))
#+END_SRC
*** center after search
I had this on 0 to center after searches.
But then scrolling also recenters point.
#+BEGIN_SRC emacs-lisp
  ;; center after search
  (setq scroll-conservatively 100)
#+END_SRC
*** Highlight current line
#+BEGIN_SRC emacs-lisp
  (when window-system
    (global-hl-line-mode)
    (set-face-background 'hl-line "#000000"))
#+END_SRC
*** Tabs
#+BEGIN_SRC emacs-lisp
  (setq-default tab-width 4 indent-tabs-mode nil)
#+END_SRC
*** Always load newest
https://ambrevar.xyz/emacs2/
#+BEGIN_SRC emacs-lisp
  (setq load-prefer-newer t)
#+END_SRC
* Evil
[[https://github.com/emacs-evil/evil-collection][Evil-Collection]]

[[https://github.com/Somelauw/evil-org-mode][evil-org]]

#+BEGIN_SRC emacs-lisp
  ;; Vim mode
  (use-package evil
    :init
    (setq evil-want-integration t) ;; This is optional since it's already set to t by default.
    (setq evil-want-keybinding nil)
    :config
    (evil-mode 1))

  (use-package evil-escape
    :init
    (setq-default evil-escape-key-sequence "fd")
    :defer t
    ;; Only needed for functions without an autoload comment (;;;###autoload).
    :commands (evil-escape-pre-command-hook)

    ;; Adding to a hook won't load the function until we invoke it.
    ;; With pre-command-hook, that means the first command we run will
    ;; load evil-escape.
    :init (add-hook 'pre-command-hook 'evil-escape-pre-command-hook))

  (use-package evil-collection
    :after evil
    :config
    (evil-collection-init))

  (use-package evil-surround
    :config
    (global-evil-surround-mode 1))

  (use-package evil-commentary
    :defer 2
    :config
    (evil-commentary-mode))

  (use-package evil-org
    :after org
    :config
    (add-hook 'org-mode-hook 'evil-org-mode)
    (add-hook 'evil-org-mode-hook
              (lambda ()
                (evil-org-set-key-theme))))

  (add-hook 'org-agenda-mode-hook
            (lambda ()
              (require 'evil-org-agenda)
              (evil-org-agenda-set-keys)))

  (defun my-center-line (&rest _)
    (evil-scroll-line-to-center nil))

  (advice-add 'evil-search-next :after #'my-center-line)
#+END_SRC
*** Lispyville
https://github.com/noctuid/lispyville

Just because of

#+BEGIN_QUOTE
If you are just looking for a way to prevent evil’s
operators from unbalancing parentheses, you can enable lispyville-mode
in your configuration and just ignore the rest of its features.
#+END_QUOTE

#+BEGIN_SRC emacs-lisp
  (use-package lispyville)

  (add-hook 'emacs-lisp-mode-hook #'lispyville-mode)
  (add-hook 'lisp-mode-hook #'lispyville-mode)
#+END_SRC
* General
Key bindings.
** TODO understand general/use-package :general
https://github.com/noctuid/general.el#integration-with-other-packages

https://github.com/noctuid/general.el/issues/22

https://www.reddit.com/r/emacs/comments/6ljtex/noob_how_i_should_organize_my_keybindings_using/

Look at other configs, e.g. https://github.com/vidjuheffex/dotemacs/blob/master/emacs.org#general

Learn when what is loaded. ~SPC j v~ is not available before org-mode
for example.

[2018-11-22 Thu 14:56]
** TODO move some of these somewhere else
#+BEGIN_SRC emacs-lisp
  ;; Custom keybinding
  (use-package general
    :defer nil
    :config
    (general-evil-setup t)

    (general-define-key
      :prefix "C-c"
      ;; bind "C-c a" to 'org-agenda
      "a" 'org-agenda
      "b" 'counsel-bookmark
      "c" 'org-capture)

    (general-define-key
      :states '(normal visual insert emacs motion)
      :prefix "SPC"
      :non-normal-prefix "M-SPC"
      "" nil
      "TAB" '(spacemacs/alternate-buffer :which-key "previous buffer")
      ;; Window
      "w"  '(:ignore t :which-key "Windows")
      "wl"  '(windmove-right :which-key "move right")
      "wh"  '(windmove-left :which-key "move left")
      "wk"  '(windmove-up :which-key "move up")
      "wj"  '(windmove-down :which-key "move bottom")
      "w/"  '(split-window-right :which-key "split right")
      "w-"  '(split-window-below :which-key "split bottom")
      "wd"  '(delete-window :which-key "delete window")
      ;; Files
      "f"  '(:ignore t :which-key "Files")
      ;; Buffers
      "b"  '(:ignore t :which-key "Buffers")
      "bd"  '(kill-this-buffer :which-key "delete buffer")
      ;; Org
      "o"  '(:ignore t :which-key "Org")
      "oc" '(org-capture :which-key "org-capture")
      "oi" '(org-clock-in :which-key "org-clock-in")
      "oo" '(org-clock-out :which-key "org-clock-out")
      "os" '(ck/org-screenshot :which-key "org-screenshot")
      ;; Search
      "s"  '(:ignore t :which-key "Search"))

    (general-define-key
      "C-x k" 'kill-this-buffer
      "M-o" 'other-window))

   (defun config-visit ()
    (interactive)
    (find-file "~/.emacs.d/config.org"))

    (general-define-key
      :states '(normal visual insert emacs)
      "C-c e" 'config-visit)
#+END_SRC

* ripgrep
#+BEGIN_SRC emacs-lisp
  (use-package rg)
#+END_SRC
* Ivy
Use amx to save recent M-x items

#+BEGIN_SRC emacs-lisp
  (use-package amx)
#+END_SRC

https://oremacs.com/2017/08/04/ripgrep/

#+BEGIN_SRC emacs-lisp
  (use-package ivy
    :diminish (ivy-mode . "") ; does not display ivy in the modeline
    :init (ivy-mode 1)        ; enable ivy globally at startup
    ;:bind (:map ivy-mode-map  ; bind in the ivy buffer
    ;       ("C-'" . ivy-avy)) ; C-' to ivy-avy
    :config
    (setq ivy-use-virtual-buffers t)    ; extend searching to bookmarks and
    (setq ivy-height 20)                ; set height of the ivy window
    (setq ivy-count-format "(%d/%d) ")  ; count format, from the ivy help page
    (setq ivy-initial-inputs-alist nil) ; no "^" at beginning
    )

  (setq counsel-grep-base-command
    "rg -i -M 120 --no-heading --line-number --color never '%s' %s")

  (general-define-key
    :states '(normal visual insert emacs)
    :prefix "SPC"
    :non-normal-prefix "M-SPC"
    "SPC" '(counsel-M-x :which-key "M-x")
    ;; Buffers
    "bb"  '(ivy-switch-buffer :which-key "buffers list")
    ;; Files
    "ff"  '(counsel-find-file :which-key "find files")
    "fr"  '(counsel-recentf :which-key "recent files")
    ;; Search
    "s/"   '(counsel-grep-or-swiper :which-key "swiper")
    "sa"   '(swiper-all :which-key "swiper-all")
    "ss"   '(counsel-rg :which-key "ripgrep"))

  ;; https://www.reddit.com/r/emacs/comments/910pga/tip_how_to_use_ivy_and_its_utilities_in_your/
  (use-package ivy-rich
    :after ivy
    :custom
    (ivy-virtual-abbreviate 'full
                            ivy-rich-switch-buffer-align-virtual-buffer t
                            ivy-rich-path-style 'abbrev)
    :config
    (ivy-rich-mode 1)

    (setq ivy-rich--display-transformers-list
     '(ivy-switch-buffer
       (:columns
        ((ivy-rich-candidate (:width 30))  ; return the candidate itself
         (ivy-rich-switch-buffer-size (:width 7))  ; return the buffer size
         (ivy-rich-switch-buffer-indicators (:width 4 :face error :align right)); return the buffer indicators
         (ivy-rich-switch-buffer-major-mode (:width 12 :face warning))          ; return the major mode info
         (ivy-rich-switch-buffer-project (:width 15 :face success))             ; return project name using `projectile'
         (ivy-rich-switch-buffer-path (:width (lambda (x) (ivy-rich-switch-buffer-shorten-path x (ivy-rich-minibuffer-width 0.3))))))  ; return file path relative to project root or `default-directory' if project is nil
        :predicate
        (lambda (cand) (get-buffer cand)))
       counsel-M-x
       (:columns
        ((counsel-M-x-transformer (:width 40))  ; thr original transfomer
         (ivy-rich-counsel-function-docstring (:face font-lock-doc-face))))  ; return the docstring of the command
       counsel-describe-function
       (:columns
        ((counsel-describe-function-transformer (:width 40))  ; the original transformer
         (ivy-rich-counsel-function-docstring (:face font-lock-doc-face))))  ; return the docstring of the function
       counsel-describe-variable
       (:columns
        ((counsel-describe-variable-transformer (:width 40))  ; the original transformer
         (ivy-rich-counsel-variable-docstring (:face font-lock-doc-face))))  ; return the docstring of the variable
       counsel-recentf
       (:columns
        ((ivy-rich-candidate (:width 0.8)) ; return the candidate itself
         (ivy-rich-file-last-modified-time (:face font-lock-comment-face)))))) ; return the last modified time of the file
  )

  (use-package swiper
    :after ivy)

  ;(use-package avy)
  (use-package counsel
    :diminish
    :after ivy
  ;  :bind*                           ; load counsel when pressed
  ;  (("M-x"     . counsel-M-x)       ; M-x use counsel
  ;   ("C-x C-f" . counsel-find-file) ; C-x C-f use counsel-find-file
  ;   ("C-x C-r" . counsel-recentf)   ; search recently edited files
  ;   ("C-c f"   . counsel-git)       ; search for files in git repo
  ;   ("C-c s"   . counsel-git-grep)  ; search for regexp in git repo
  ;   ("C-c /"   . counsel-ag)        ; search for regexp in git repo using ag
  ;   ("C-c l"   . counsel-locate))   ; search for files or else using locate
    )

  (general-define-key
    :states '(motion normal visual insert emacs)
    "C-s" 'counsel-grep-or-swiper
    "C-c C-r" 'ivy-resume
    "C-h f" 'counsel-describe-function
    "C-h v" 'counsel-describe-variable
    "M-x" 'counsel-M-x)

  (setq ivy-re-builders-alist
    '((counsel-M-x . ivy--regex-fuzzy)
      (counsel-describe-function . ivy--regex-fuzzy)
      (counsel-describe-variable . ivy--regex-fuzzy)
      (t . ivy--regex-plus)))
#+END_SRC
* Which-key
#+BEGIN_SRC emacs-lisp
  ;; Which Key
  (use-package which-key
    :defer nil
    :init
    (setq which-key-separator " ")
    (setq which-key-prefix-prefix "+")
    :config
    (which-key-mode 1))
#+END_SRC
* Ranger
#+BEGIN_SRC emacs-lisp
  (use-package ranger
  :init
    (general-define-key
      :states '(normal visual insert emacs)
      :prefix "SPC"
      :non-normal-prefix "M-SPC"
      "fn" '(ranger :which-key "Ranger"))
  :config
    (ranger-override-dired-mode t)
  )
#+END_SRC
* eshell
https://www.reddit.com/r/emacs/comments/9vk7iz/emacs_popup_shell/
#+BEGIN_SRC emacs-lisp
  (defun eshell-here ()
    "Opens up a new shell in the directory associated with the
  current buffer's file. The eshell is renamed to match that
  directory to make multiple eshell windows easier."
    (interactive)
    (let* ((parent (if (buffer-file-name)
                       (file-name-directory (buffer-file-name))
                     default-directory))
           (height (/ (window-total-height) 3))
           (name   (car (last (split-string parent "/" t)))))
      (split-window-vertically (- height))
      (other-window 1)
      (eshell "new")
      (rename-buffer (concat "*eshell: " name "*"))

      (insert (concat "ls"))
      (eshell-send-input)))

  (defun eshell/x ()
    (kill-buffer-and-window)) ; (I also set kill-buffer-and-window to C-x K)
#+END_SRC
* Projectile
#+BEGIN_SRC emacs-lisp
;; Projectile
(use-package projectile
  :init
  (setq projectile-require-project-root nil)
  :config
  (projectile-mode 1))
#+END_SRC
* Org
*** use-package
#+BEGIN_SRC emacs-lisp
  (use-package org
    :ensure org-plus-contrib
    :init
      (defun ck-set-home-agenda ()
        (interactive)
        (setq org-agenda-tag-filter-preset '("-@work" "-elk" "-REFILE" "-learnsrs")))

      (defun ck-set-work-agenda ()
        (interactive)
        (setq org-agenda-tag-filter-preset '("-@home" "-elk" "-REFILE" "-learnsrs")))

      (defun ck-set-learn-agenda ()
        (interactive)
        (setq org-agenda-tag-filter-preset '("+learnsrs")))

      (when (my-system-type-is-gnu)
        (setq my-org-dir "~/org/"))

      (when (my-system-is-mypc)
        (setq my-org-dir "c:/docs/org/"
              org-agenda-tag-filter-preset '("-@work" "-elk" "-REFILE" "-learnsrs")))

      (when (my-system-is-myoldworkpc)
        (setq my-org-dir "c:/Users/chris.keschnat/Documents/docs/org/"
              org-agenda-tag-filter-preset '("-@home" "-elk" "-REFILE" "-learnsrs")))

      (when (my-system-is-myworkpc)
        (setq my-org-dir "c:/docs/org/"
              org-agenda-tag-filter-preset '("-@home" "-elk" "-REFILE" "-learnsrs")))

    :mode
    (("\\.txt$" . org-mode))

    :config
#+END_SRC
*** Keybindings
#+BEGIN_SRC emacs-lisp
 (general-def 'motion
   "RET" 'org-open-at-point
   "t" 'org-todo)
#+END_SRC
*** Background colors for export
#+BEGIN_SRC emacs-lisp
;; background colors for export http://ivanmalison.github.io/dotfiles/#setbackgroundcolorofsourceblocksforexport
    (progn
    (defun imalison:org-inline-css-hook (exporter)
        "Insert custom inline css to automatically set the
        background of code to whatever theme I'm using's background"
        (when (eq exporter 'html)
        (let* ((my-pre-bg (face-background 'default))
                (my-pre-fg (face-foreground 'default)))
            (setq
            org-html-head-extra
            (concat
            org-html-head-extra
            (format "<style type=\"text/css\">\n pre.src {background-color: %s; color: %s;}</style>\n"
                    my-pre-bg my-pre-fg))))))

    (add-hook 'org-export-before-processing-hook 'imalison:org-inline-css-hook))
#+END_SRC

*** Ellipsis
"↝" "⇉" "⇝" "⇢" "⇨" "⇰" "➔" "➙" "➛" "➜" "➝" "➞"

"➟" "➠" "➡" "➥" "➦" "➧" "➨"

"➩" "➪" "➮" "➯" "➱" "➲"

"➳" "➵" "➸" "➺" "➻" "➼" "➽"
arrow heads

"➢" "➣" "➤" "≪", "≫", "«", "»"
other arrows

"↞" "↠" "↟" "↡" "↺" "↻"
lightening

"⚡"
other symbols

…, ▼, ↴, , ∞, ⬎, ⤷, ⤵

→
⤵
#+BEGIN_SRC emacs-lisp
  (setq org-ellipsis " ▼")
#+END_SRC
*** Screenshots
http://www.sastibe.de/2018/11/take-screenshots-straight-into-org-files-in-emacs-on-win10/

Maybe inside a subdirectory? E.g.:
#+BEGIN_EXAMPLE
(concat default-directory
        "images/"
        (file-name-nondirectory buffer-file-name)
        "_"
        (format-time-string "%Y%m%d_%H%M%S_"))  ".png"
#+END_EXAMPLE

#+BEGIN_SRC emacs-lisp
  (defun ck/org-screenshot ()
    "Take a screenshot into a time stamped unique-named file in the
  same directory as the org-buffer and insert a link to this file."
    (interactive)
    (setq filename
          (concat
           (make-temp-name
            (concat (buffer-file-name)
                    "_"
                    (format-time-string "%Y%m%d_%H%M%S_")) ) ".png"))
    (shell-command "snippingtool /clip")
    (shell-command (concat "powershell -command \"Add-Type -AssemblyName System.Windows.Forms;if ($([System.Windows.Forms.Clipboard]::ContainsImage())) {$image = [System.Windows.Forms.Clipboard]::GetImage();[System.Drawing.Bitmap]$image.Save('" filename "',[System.Drawing.Imaging.ImageFormat]::Png); Write-Output 'clipboard content saved as file'} else {Write-Output 'clipboard does not contain image data'}\""))
    (insert (concat "[[file:" filename "]]"))
    (org-display-inline-images))
#+END_SRC
*** CANCELLED org-super-agenda                                  :CANCELLED:
CLOSED: [2018-12-21 Fri 09:31]
:LOGBOOK:
- State "CANCELLED"  from              [2018-12-21 Fri 09:31]
:END:
#+BEGIN_SRC emacs-lisp
  (use-package org-super-agenda
    :config (org-super-agenda-mode))

  (setq org-agenda-custom-commands
        '(("c" "Super Agenda" agenda
           (org-super-agenda-mode)
           ((org-super-agenda-groups
             '(
               (:name "Next Items"
                      :time-grid t
                      :tag ("NEXT" "outbox"))
               (:name "Important"
                      :priority "A")
               (:name "Today"
                      :time-grid t
                      :scheduled today)
               (:name "Quick Picks"
                      :effort < 00:30 ; ← that one doesn't seem to work, no?
                      )
               (:priority<= "B"
                            :order 1)
               )))
           (org-agenda nil "a"))))
  (let ((org-super-agenda-groups
         '(;; Each group has an implicit boolean OR operator between its selectors.
           (:name "Today"  ; Optionally specify section name
                  :time-grid t  ; Items that appear on the time grid
                  :todo "TODAY")  ; Items that have this TODO keyword
           (:name "Important"
                  ;; Single arguments given alone
                  :tag "bills"
                  :priority "A")
           ;; Set order of multiple groups at once
           (:order-multi (2 (:name "Shopping in town"
                                   ;; Boolean AND group matches items that match all subgroups
                                   :and (:tag "shopping" :tag "@town"))
                            (:name "Food-related"
                                   ;; Multiple args given in list with implicit OR
                                   :tag ("food" "dinner"))
                            (:name "Personal"
                                   :habit t
                                   :tag "personal")
                            (:name "Space-related (non-moon-or-planet-related)"
                                   ;; Regexps match case-insensitively on the entire entry
                                   :and (:regexp ("space" "NASA")
                                                 ;; Boolean NOT also has implicit OR between selectors
                                                 :not (:regexp "moon" :tag "planet")))))
           ;; Groups supply their own section names when none are given
           (:todo "WAITING" :order 8)  ; Set order of this section
           (:todo ("SOMEDAY" "TO-READ" "CHECK" "TO-WATCH" "WATCHING")
                  ;; Show this group at the end of the agenda (since it has the
                  ;; highest number). If you specified this group last, items
                  ;; with these todo keywords that e.g. have priority A would be
                  ;; displayed in that group instead, because items are grouped
                  ;; out in the order the groups are listed.
                  :order 9)
           (:priority<= "B"
                        ;; Show this section after "Today" and "Important", because
                        ;; their order is unspecified, defaulting to 0. Sections
                        ;; are displayed lowest-number-first.
                        :order 1)
           ;; After the last group, the agenda will display items that didn't
           ;; match any of these groups, with the default order position of 99
           )))
    (org-agenda nil "a"))
#+END_SRC
*** org-archive-subtree-hierachical
#+BEGIN_SRC emacs-lisp
;; org-archive-subtree-hierarchical.el
;; modified from https://lists.gnu.org/archive/html/emacs-orgmode/2014-08/msg00109.html

;; In orgmode
;; * A
;; ** AA
;; *** AAA
;; ** AB
;; *** ABA
;; Archiving AA will remove the subtree from the original file and create
;; it like that in archive target:

;; * AA
;; ** AAA

;; And this give you
;; * A
;; ** AA
;; *** AAA


(require 'org-archive)

(defun org-archive-subtree-hierarchical--line-content-as-string ()
    "Returns the content of the current line as a string"
    (save-excursion
    (beginning-of-line)
    (buffer-substring-no-properties
    (line-beginning-position) (line-end-position))))

(defun org-archive-subtree-hierarchical--org-child-list ()
    "This function returns all children of a heading as a list. "
    (interactive)
    (save-excursion
    ;; this only works with org-version > 8.0, since in previous
    ;; org-mode versions the function (org-outline-level) returns
    ;; gargabe when the point is not on a heading.
    (if (= (org-outline-level) 0)
        (outline-next-visible-heading 1)
        (org-goto-first-child))
    (let ((child-list (list (org-archive-subtree-hierarchical--line-content-as-string))))
        (while (org-goto-sibling)
        (setq child-list (cons (org-archive-subtree-hierarchical--line-content-as-string) child-list)))
        child-list)))

(defun org-archive-subtree-hierarchical--org-struct-subtree ()
    "This function returns the tree structure in which a subtree
belongs as a list."
    (interactive)
    (let ((archive-tree nil))
    (save-excursion
        (while (org-up-heading-safe)
        (let ((heading
                (buffer-substring-no-properties
                (line-beginning-position) (line-end-position))))
            (if (eq archive-tree nil)
                (setq archive-tree (list heading))
            (setq archive-tree (cons heading archive-tree))))))
    archive-tree))

(defun org-archive-subtree-hierarchical ()
    "This function archives a subtree hierarchical"
    (interactive)
    (let ((org-tree (org-archive-subtree-hierarchical--org-struct-subtree))
        (this-buffer (current-buffer))
        (file (abbreviate-file-name
                (or (buffer-file-name (buffer-base-buffer))
                    (error "No file associated to buffer")))))
    (save-excursion
        (setq location (org-get-local-archive-location)
            afile (org-extract-archive-file location)
            heading (org-extract-archive-heading location)
            infile-p (equal file (abbreviate-file-name (or afile ""))))
        (unless afile
        (error "Invalid `org-archive-location'"))
        (if (> (length afile) 0)
            (setq newfile-p (not (file-exists-p afile))
                visiting (find-buffer-visiting afile)
                buffer (or visiting (find-file-noselect afile)))
        (setq buffer (current-buffer)))
        (unless buffer
        (error "Cannot access file \"%s\"" afile))
        (org-cut-subtree)
        (set-buffer buffer)
        (org-mode)
        (goto-char (point-min))
        (while (not (equal org-tree nil))
        (let ((child-list (org-archive-subtree-hierarchical--org-child-list)))
            (if (member (car org-tree) child-list)
                (progn
                (search-forward (car org-tree) nil t)
                (setq org-tree (cdr org-tree)))
            (progn
                (goto-char (point-max))
                (newline)
                (org-insert-struct org-tree)
                (setq org-tree nil)))))
        (newline)
        (org-yank)
        (when (not (eq this-buffer buffer))
        (save-buffer))
        (message "Subtree archived %s"
                (concat "in file: " (abbreviate-file-name afile))))))

(defun org-insert-struct (struct)
    "TODO"
    (interactive)
    (when struct
    (insert (car struct))
    (newline)
    (org-insert-struct (cdr struct))))

(defun org-archive-subtree ()
    (org-archive-subtree-hierarchical)
    )
#+END_SRC
*** Archive location
#+BEGIN_SRC emacs-lisp
(setq org-archive-location "archive/%s_archive::")
#+END_SRC
*** Hide markers
#+BEGIN_SRC emacs-lisp
(setq org-hide-emphasis-markers t)
#+END_SRC
*** Fold everything when opening
#+BEGIN_SRC emacs-lisp
(setq org-startup-indented t)
#+END_SRC
*** No superscripts
#+BEGIN_SRC emacs-lisp
(setq org-export-with-sub-superscripts nil)
#+END_SRC
*** src-blocks
#+BEGIN_SRC emacs-lisp
  (setq org-confirm-babel-evaluate nil
        org-src-fontify-natively t
        org-src-tab-acts-natively t
        org-src-window-setup 'current-window)
#+END_SRC
*** Agenda
#+BEGIN_SRC emacs-lisp
  (setq org-agenda-files (list my-org-dir))

  (setq org-agenda-text-search-extra-files '(agenda-archives))
#+END_SRC
*** Not yet sorted
#+BEGIN_SRC emacs-lisp
  ;; TODO(chris) use this?
  ;; (setq org-publish-project-alist
  ;;       '(("org"
  ;;          :base-directory "c:/docs/org/"
  ;;          :publishing-directory "c:/docs/org/html/"
  ;;          :publishing-function org-html-publish-to-html
  ;;          :section-numbers nil
  ;;          :table-of-contents nil)))

  (setq org-blank-before-new-entry '((heading . nil) (plain-list-item . auto)))

  (setq org-enforce-todo-dependencies t)
  (setq org-enforce-todo-checkbox-dependencies t)

  (setq org-log-into-drawer t)
  (setq org-log-redeadline (quote time))
  (setq org-log-reschedule (quote time))
  (setq org-log-done (quote time))

  (setq org-clock-persist 'history)
  (org-clock-persistence-insinuate)

  (setq org-default-notes-file (concat (car org-agenda-files) "inbox.org"))
  ;; More headings for refile
  ;; (setq org-refile-targets '((org-agenda-files . (:maxlevel . 6))))
  (setq org-refile-targets '((nil :maxlevel . 9)
                              (org-agenda-files :maxlevel . 9)))
  (setq org-refile-use-outline-path 'file)              ; Show full paths for refiling
  (setq org-outline-path-complete-in-steps nil)         ; Refile in a single go

  (setq helm-org-rifle-show-path t)
  (setq org-refile-allow-creating-parent-nodes 'confirm)

  (setq org-todo-keyword-faces
          '(("TODO" . org-warning)
          ("SOMEDAY" . (:foreground "moccasin" :weight bold))
          ("WAIT" . (:foreground "lavender blush" :weight bold))
          ("CANCELLED" . org-done)))

  (setq org-todo-keywords
          '((sequence "TODO(t)" "WAIT(w@/!)" "SOMEDAY(s)" "|" "CANCELLED(c@)" "DONE(d!)")))
  (setq org-tag-alist (quote (
                              ("@home" . ?H)
                              ("@work" . ?W)
                              ("WAIT" . ?A)
                              ("PERSONAL" . ?P)
                              ("NOTE" . ?n)
                              ("CANCELLED" . ?C)
                              ("FLAGGED" . ??)
                              ("watch" . ?w)
                              ("read" . ?r)
                              )))

  (setq org-capture-templates
          (quote (("t" "todo" entry (file "") "* TODO %?\nEntered: %U\n")
                  ("w" "wait" entry (file "") "* WAIT %?\nEntered: %U\n")
                  ("c" "clipboard" entry (file "") "* TODO %?\n\n#+BEGIN_QUOTE\n  %c\n#+END_QUOTE\n\nEntered: %U\n")
                  ("l" "linked todo" entry (file "") "* TODO %?\nEntered: %U\n%a\n")
                  ("n" "note" entry (file "") "* %? :NOTE:\n%U\n%a\n")
                  )))

  (add-to-list 'org-structure-template-alist
                  (list "hh" (concat "#+SETUPFILE: themes/theme-readtheorg-local.setup\n"
                                  "#+OPTIONS: html-postamble:nil num:nil\n"
                                  "#+FILETAGS: ?\n")))

  (add-to-list 'org-structure-template-alist
                  (list "p" (concat ":PROPERTIES:\n"
                                  "?\n"
                                  ":END:")))

  (add-to-list 'org-structure-template-alist
                  (list "eh" (concat ":EXPORT_FILE_NAME: ?\n"
                                  ":EXPORT_TITLE:\n"
                                  ":EXPORT_OPTIONS: html-postamble:nil num:nil")))

  (add-to-list 'org-structure-template-alist
               '("el" "#+BEGIN_SRC emacs-lisp\n?\n#+END_SRC"))

  (add-hook 'org-capture-mode-hook 'evil-insert-state)

  (setq org-use-fast-todo-selection t)
  (setq org-todo-state-tags-triggers
          (quote (("CANCELLED" ("CANCELLED" . t))
                  ("WAIT" ("WAIT" . t))
                  (done ("WAIT"))
                  ("" ("WAIT") ("CANCELLED"))
                  ("TODO" ("WAIT") ("CANCELLED"))
                  ("DONE" ("WAIT") ("CANCELLED")))))
#+END_SRC
*** Custom agenda
#+BEGIN_SRC emacs-lisp

  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  ;; https://blog.aaronbieber.com/2016/09/24/an-agenda-for-life-with-org-mode.html
  ;; maybe use https://github.com/alphapapa/org-super-agenda

  (defun air-org-skip-subtree-if-priority (priority)
      "Skip an agenda subtree if it has a priority of PRIORITY.

      PRIORITY may be one of the characters ?A, ?B, or ?C."
      (let ((subtree-end (save-excursion (org-end-of-subtree t)))
          (pri-value (* 1000 (- org-lowest-priority priority)))
          (pri-current (org-get-priority (thing-at-point 'line t))))
      (if (= pri-value pri-current)
          subtree-end
          nil)))

  ;; (setq org-agenda-custom-commands
  ;;       '(("c" "Simple agenda view"
  ;;          ((tags "PRIORITY=\"A\""
  ;;                 ((org-agenda-skip-function '(org-agenda-skip-entry-if 'todo 'done))
  ;;                  (org-agenda-overriding-header "High-priority unfinished tasks:")))
  ;;           (agenda "")
  ;;           (alltodo ""
  ;;                    ((org-agenda-skip-function
  ;;                      '(or (air-org-skip-subtree-if-priority ?A)
  ;;                           (org-agenda-skip-if nil '(scheduled deadline))))))))))

  (setq org-agenda-custom-commands
          '(("d" "Daily agenda and all TODOs"
              ((tags "PRIORITY=\"A\""
                  ((org-agenda-skip-function '(org-agenda-skip-entry-if 'todo 'done))
                      (org-agenda-overriding-header "High-priority unfinished tasks:")))
              (agenda "" ((org-agenda-span 'day)))
              (alltodo ""
                      ((org-agenda-skip-function '(or (air-org-skip-subtree-if-priority ?A)
                                                      (org-agenda-skip-if nil '(scheduled deadline))))
                      (org-agenda-overriding-header "ALL normal priority tasks:"))))
              ((org-agenda-compact-blocks t)))))


  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

  ;; (setq org-agenda-custom-commands
  ;;       (quote (("N" "Notes" tags "NOTE"
  ;;                (
  ;;                 (org-agenda-overriding-header "Notes")
  ;;                 (org-tags-match-list-sublevels t)
  ;;                 )
  ;;                )
  ;;              )
  ;;       )
  ;; )
#+END_SRC

*** Faces/UI
#+BEGIN_SRC emacs-lisp
  (when (display-graphic-p)
    (let* ((variable-tuple (cond ((x-list-fonts "Source Sans Pro") '(:font "Source Sans Pro"))
                                 ((x-list-fonts "Lucida Grande")   '(:font "Lucida Grande"))
                                 ((x-list-fonts "Verdana")         '(:font "Verdana"))
                                 ((x-family-fonts "Sans Serif")    '(:family "Sans Serif"))
                                 (nil (warn "Cannot find a Sans Serif Font.  Install Source Sans Pro."))))
           (base-font-color     (face-foreground 'default nil 'default))
           (headline           `(:inherit default :weight bold :foreground ,base-font-color)))

      (custom-theme-set-faces 'user
                              `(org-level-8 ((t (,@headline ,@variable-tuple))))
                              `(org-level-7 ((t (,@headline ,@variable-tuple))))
                              `(org-level-6 ((t (,@headline ,@variable-tuple))))
                              `(org-level-5 ((t (,@headline ,@variable-tuple))))
                              `(org-level-4 ((t (,@headline ,@variable-tuple :height 1.1))))
                              `(org-level-3 ((t (,@headline ,@variable-tuple :height 1.25))))
                              `(org-level-2 ((t (,@headline ,@variable-tuple :height 1.5))))
                              `(org-level-1 ((t (,@headline ,@variable-tuple :height 1.75))))
                              `(org-document-title ((t (,@headline ,@variable-tuple :height 1.5 :underline nil))))))

    (setq org-fontify-done-headline t)
    (custom-set-faces
     '(org-done ((t (:foreground "PaleGreen"
                     :weight normal
                     :strike-through t))))
     '(org-headline-done
                ((((class color) (min-colors 16) (background dark))
                   (:foreground "LightSalmon" :strike-through t))))))

  ;; circles instead of dashes in lists
  (font-lock-add-keywords 'org-mode
                          '(("^ *\\([-]\\) "
                              (0 (prog1 () (compose-region (match-beginning 1) (match-end 1) "•"))))))
  ) ;; END use-package org
#+END_SRC
*** Bullets
https://zhangda.wordpress.com/2016/02/15/configurations-for-beautifying-emacs-org-mode/

#+BEGIN_SRC emacs-lisp
  (use-package org-bullets)
  ;;:config
    ;;(setq org-bullets-bullet-list '("■" "◆" "▲" "▶"))
    ;;(setq org-bullets-bullet-list '("✙" "♱" "♰" "☥" "✞" "✟" "✝" "†" "✠" "✚" "✜" "✛" "✢" "✣" "✤" "✥")))
    ;;(setq org-bullets-bullet-list '("✡" "⎈" "✽" "✲" "✱" "✻" "✼" "✽" "✾" "✿" "❀" "❁" "❂" "❃" "❄" "❅" "❆" "❇"))
    ;;(setq org-bullets-bullet-list '("○" "☉" "◎" "◉" "○" "◌" "◎" "●" "◦" "◯" "⚪" "⚫" "⚬" "❍" "￮" "⊙" "⊚" "⊛" "∙" "∘"))
    ;;(setq org-bullets-bullet-list '("◐" "◑" "◒" "◓" "◴" "◵" "◶" "◷" "⚆" "⚇" "⚈" "⚉" "♁" "⊖" "⊗" "⊘"))
    ;;(setq org-bullets-bullet-list '("♠" "♣" "♥" "♦" "♤" "♧" "♡" "♢"))
    ;;(setq org-bullets-bullet-list '("☯" "☰" "☱" "☲" "☳" "☴" "☵" "☶" "☷"))
    ;;(setq org-bullets-bullet-list '("☀" "♼" "☼" "☾" "☽" "☣" "§" "¶" "‡" "※" "✕" "△" "◇" "▶" "◀" "◈"))

  (add-hook 'org-mode-hook (lambda () (org-bullets-mode 1)))
#+END_SRC
**** make org-bullets faster under windows
https://github.com/sabof/org-bullets/issues/11#issuecomment-439228372

#+BEGIN_SRC emacs-lisp
  (setq inhibit-compacting-font-caches t)
#+END_SRC
*** CANCELLED org-brain                                         :CANCELLED:
CLOSED: [2018-11-22 Thu 15:31]

https://github.com/Kungsgeten/org-brain

#+BEGIN_SRC emacs-lisp
  (use-package org-brain
    :init
    (setq org-brain-path "c:/docs/org/brain")
    ;; For Evil users
    (with-eval-after-load 'evil
      (evil-set-initial-state 'org-brain-visualize-mode 'emacs))
    :config
    (setq org-id-track-globally t)
    (setq org-id-locations-file "~/.emacs.d/.org-id-locations")
    (push '("b" "Brain" plain (function org-brain-goto-end)
            "* %i%?" :empty-lines 1)
          org-capture-templates)
    (setq org-brain-visualize-default-choices 'all)
    (setq org-brain-title-max-length 12))
#+END_SRC
*** htmlize
To export to html.

#+BEGIN_SRC emacs-lisp
  (use-package htmlize)
#+END_SRC
*** org-drill
https://stackoverflow.com/questions/34983106/how-to-install-org-drill
#+BEGIN_SRC emacs-lisp
  ;;(add-to-list 'load-path "~/.emacs.d/elpa/org-plus-contrib-20181217/")
  (require 'cl)
  (require 'org-drill)
#+END_SRC
*** pamparam
#+BEGIN_SRC emacs-lisp
  (use-package pamparam :ensure t)
#+END_SRC
*** ox-jira
#+BEGIN_SRC emacs-lisp
  (use-package ox-jira
    :defer 1)
#+END_SRC
* Navigation
*** Alternate buffer
#+BEGIN_SRC emacs-lisp
(defun spacemacs/alternate-buffer (&optional window)
  "Switch back and forth between current and last buffer in the
current window."
  (interactive)
  (let ((current-buffer (window-buffer window))
        (buffer-predicate
         (frame-parameter (window-frame window) 'buffer-predicate)))
    ;; switch to first buffer previously shown in this window that matches
    ;; frame-parameter `buffer-predicate'
    (switch-to-buffer
     (or (cl-find-if (lambda (buffer)
                       (and (not (eq buffer current-buffer))
                            (or (null buffer-predicate)
                                (funcall buffer-predicate buffer))))
                     (mapcar #'car (window-prev-buffers window)))
         ;; `other-buffer' honors `buffer-predicate' so no need to filter
         (other-buffer current-buffer t)))))
#+END_SRC
*** Movement
#+BEGIN_SRC emacs-lisp
  (general-define-key
    :states '(normal visual insert emacs)
    "C-j" 'forward-paragraph
    "C-k" 'backward-paragraph)

  ;; TODO(chris): make this work (works with eval-region)
  ;; (evil-define-key 'evilified org-agenda-mode-map (kbd "j") 'org-agenda-next-item)
  ;; (evil-define-key 'evilified org-agenda-mode-map (kbd "k") 'org-agenda-previous-item)
#+END_SRC
* Hydra
https://github.com/abo-abo/hydra/wiki/Org-agenda

#+BEGIN_SRC emacs-lisp
  (use-package hydra
    :defer 2
    :config

    ;; Hydra for org agenda (graciously taken from Spacemacs)
    (defhydra hydra-org-agenda (:pre (setq which-key-inhibit t)
                                     :post (setq which-key-inhibit nil)
                                     :hint none)
      "
    Org agenda (_q_uit)

    ^Clock^      ^Visit entry^              ^Date^             ^Other^
    ^-----^----  ^-----------^------------  ^----^-----------  ^-----^---------
    _ci_ in      _SPC_ in other window      _ds_ schedule      _gr_ reload
    _co_ out     _TAB_ & go to location     _dd_ set deadline  _._  go to today
    _cq_ cancel  _RET_ & del other windows  _dt_ timestamp     _gd_ go to date
    _cj_ jump    _o_   link                 _+_  do later      ^^
    ^^           ^^                         _-_  do earlier    ^^
    ^^           ^^                         ^^                 ^^
    ^View^          ^Filter^                 ^Headline^         ^Toggle mode^
    ^----^--------  ^------^---------------  ^--------^-------  ^-----------^----
    _vd_ day        _ft_ by tag              _ht_ set status    _tf_ follow
    _vw_ week       _fr_ refine by tag       _hk_ kill          _tl_ log
    _vt_ fortnight  _fc_ by category         _hr_ refile        _ta_ archive trees
    _vm_ month      _fh_ by top headline     _hA_ archive       _tA_ archive files
    _vy_ year       _fx_ by regexp           _h:_ set tags      _tr_ clock report
    _vn_ next span  _fd_ delete all filters  _hp_ set priority  _td_ diaries
    _vp_ prev span  ^^                       ^^                 ^^
    _vr_ reset      ^^                       ^^                 ^^
    ^^              ^^                       ^^                 ^^
    "
      ;; Entry
      ("hA" org-agenda-archive-default)
      ("hk" org-agenda-kill)
      ("hp" org-agenda-priority)
      ("hr" org-agenda-refile)
      ("h:" org-agenda-set-tags)
      ("ht" org-agenda-todo)
      ;; Visit entry
      ("o"   link-hint-open-link :exit t)
      ("<tab>" org-agenda-goto :exit t)
      ("TAB" org-agenda-goto :exit t)
      ("SPC" org-agenda-show-and-scroll-up)
      ("RET" org-agenda-switch-to :exit t)
      ;; Date
      ("dt" org-agenda-date-prompt)
      ("dd" org-agenda-deadline)
      ("+" org-agenda-do-date-later)
      ("-" org-agenda-do-date-earlier)
      ("ds" org-agenda-schedule)
      ;; View
      ("vd" org-agenda-day-view)
      ("vw" org-agenda-week-view)
      ("vt" org-agenda-fortnight-view)
      ("vm" org-agenda-month-view)
      ("vy" org-agenda-year-view)
      ("vn" org-agenda-later)
      ("vp" org-agenda-earlier)
      ("vr" org-agenda-reset-view)
      ;; Toggle mode
      ("ta" org-agenda-archives-mode)
      ("tA" (org-agenda-archives-mode 'files))
      ("tr" org-agenda-clockreport-mode)
      ("tf" org-agenda-follow-mode)
      ("tl" org-agenda-log-mode)
      ("td" org-agenda-toggle-diary)
      ;; Filter
      ("fc" org-agenda-filter-by-category)
      ("fx" org-agenda-filter-by-regexp)
      ("ft" org-agenda-filter-by-tag)
      ("fr" org-agenda-filter-by-tag-refine)
      ("fh" org-agenda-filter-by-top-headline)
      ("fd" org-agenda-filter-remove-all)
      ;; Clock
      ("cq" org-agenda-clock-cancel)
      ("cj" org-agenda-clock-goto :exit t)
      ("ci" org-agenda-clock-in :exit t)
      ("co" org-agenda-clock-out)
      ;; Other
      ("q" nil :exit t)
      ("gd" org-agenda-goto-date)
      ("." org-agenda-goto-today)
      ("gr" org-agenda-redo)))

     (general-define-key
       :states 'motion
       :keymaps 'org-agenda-mode-map
       "v" 'hydra-org-agenda/body)

#+END_SRC
* puppet
https://github.com/puppetlabs/puppet-syntax-emacs

*** TODO defer loading of puppet stuff

#+BEGIN_SRC emacs-lisp
;;; puppet-mode.el --- A simple mode for editing puppet manifests

;; Copyright (C) 2011 Puppet Labs Inc

;; Author: Russ Allbery <rra@stanford.edu>
;; Maintainer: <info@puppetlabs.com>

;; This file is not part of GNU Emacs.

;; Licensed under the Apache License, Version 2.0 (the "License");
;; you may not use this file except in compliance with the License.
;; You may obtain a copy of the License at
;;
;;     http://www.apache.org/licenses/LICENSE-2.0
;;
;; Unless required by applicable law or agreed to in writing, software
;; distributed under the License is distributed on an "AS IS" BASIS,
;; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
;; See the License for the specific language governing permissions and
;; limitations under the License.

;;; Commentary:

;; A simple mode for editing puppet manifests.

;;; Code:

(defconst puppet-mode-version "0.2")

(defvar puppet-mode-abbrev-table nil
  "Abbrev table in use in puppet-mode buffers.")

(define-abbrev-table 'puppet-mode-abbrev-table ())

(defcustom puppet-indent-level 2
  "*Indentation of Puppet statements."
  :type 'integer :group 'puppet)

(defcustom puppet-include-indent 2
  "*Indentation of continued Puppet include statements."
  :type 'integer :group 'puppet)

(defvar puppet-mode-map
  (let ((map (make-sparse-keymap)))
    (define-key map "\C-j" 'newline-and-indent)
    (define-key map "\C-m" 'newline-and-indent)
    map)
  "Key map used in puppet-mode buffers.")

(defvar puppet-mode-syntax-table
  (let ((table (make-syntax-table)))
    (modify-syntax-entry ?\' "\"'"  table)
    (modify-syntax-entry ?\" "\"\"" table)
    (modify-syntax-entry ?#  "<"    table)
    (modify-syntax-entry ?\n ">#"   table)
    (modify-syntax-entry ?\\ "\\"   table)
    (modify-syntax-entry ?$  "'"    table)
    (modify-syntax-entry ?-  "_"    table)
    (modify-syntax-entry ?:  "_"    table)
    (modify-syntax-entry ?>  "."    table)
    (modify-syntax-entry ?=  "."    table)
    (modify-syntax-entry ?\; "."    table)
    (modify-syntax-entry ?\( "()"   table)
    (modify-syntax-entry ?\) ")("   table)
    (modify-syntax-entry ?\{ "(}"   table)
    (modify-syntax-entry ?\} "){"   table)
    (modify-syntax-entry ?\[ "(]"   table)
    (modify-syntax-entry ?\] ")["   table)
    table)
  "Syntax table in use in puppet-mode buffers.")

(defcustom puppet-indent-tabs-mode nil
  "*Indentation can insert tabs in puppet mode if this is non-nil."
  :type 'boolean :group 'puppet)

(defcustom puppet-comment-column 32
  "*Indentation column of comments."
  :type 'integer :group 'puppet)

(defun puppet-count-matches (re start end)
  "The same as Emacs 22 count-matches, for portability to other versions
of Emacs."
  (save-excursion
    (let ((n 0))
      (goto-char start)
      (while (re-search-forward re end t) (setq n (1+ n)))
      n)))

(defun puppet-comment-line-p ()
  "Return non-nil iff this line is a comment."
  (save-excursion
    (save-match-data
      (beginning-of-line)
      (looking-at (format "\\s-*%s" comment-start)))))

(defun puppet-block-indent ()
  "If point is in a block, return the indentation of the first line of that
block (the line containing the opening brace).  Used to set the indentation
of the closing brace of a block."
  (save-excursion
    (save-match-data
      (let ((opoint (point))
            (apoint (search-backward "{" nil t)))
        (when apoint
          ;; This is a bit of a hack and doesn't allow for strings.  We really
          ;; want to parse by sexps at some point.
          (let ((close-braces (puppet-count-matches "}" apoint opoint))
                (open-braces 0))
            (while (and apoint (> close-braces open-braces))
              (setq apoint (search-backward "{" nil t))
              (when apoint
                (setq close-braces (puppet-count-matches "}" apoint opoint))
                (setq open-braces (1+ open-braces)))))
          (if apoint
              (current-indentation)
            nil))))))

(defun puppet-in-array ()
  "If point is in an array, return the position of the opening '[' of
that array, else return nil."
  (save-excursion
    (save-match-data
      (let ((opoint (point))
            (apoint (search-backward "[" nil t)))
        (when apoint
          ;; This is a bit of a hack and doesn't allow for strings.  We really
          ;; want to parse by sexps at some point.
          (let ((close-brackets (puppet-count-matches "]" apoint opoint))
                (open-brackets 0))
            (while (and apoint (> close-brackets open-brackets))
              (setq apoint (search-backward "[" nil t))
              (when apoint
                (setq close-brackets (puppet-count-matches "]" apoint opoint))
                (setq open-brackets (1+ open-brackets)))))
          apoint)))))

(defun puppet-in-include ()
  "If point is in a continued list of include statements, return the position
of the initial include plus puppet-include-indent."
  (save-excursion
    (save-match-data
      (let ((include-column nil)
            (not-found t))
        (while not-found
          (forward-line -1)
          (cond
           ((bobp)
            (setq not-found nil))
           ((looking-at "^\\s-*include\\s-+.*,\\s-*$")
            (setq include-column
                  (+ (current-indentation) puppet-include-indent))
            (setq not-found nil))
           ((not (looking-at ".*,\\s-*$"))
            (setq not-found nil))))
        include-column))))

(defun puppet-indent-line ()
  "Indent current line as puppet code."
  (interactive)
  (beginning-of-line)
  (if (bobp)
      (indent-line-to 0)                ; First line is always non-indented
    (let ((not-indented t)
          (array-start (puppet-in-array))
          (include-start (puppet-in-include))
          (block-indent (puppet-block-indent))
          cur-indent)
      (cond
       (array-start
        ;; This line probably starts with an element from an array.
        ;; Indent the line to the same indentation as the first
        ;; element in that array.  That is, this...
        ;;
        ;;    exec {
        ;;      "add_puppetmaster_mongrel_startup_links":
        ;;      command => "string1",
        ;;      creates => [ "string2", "string3",
        ;;      "string4", "string5",
        ;;      "string6", "string7",
        ;;      "string3" ],
        ;;      refreshonly => true,
        ;;    }
        ;;
        ;; ...should instead look like this:
        ;;
        ;;    exec {
        ;;      "add_puppetmaster_mongrel_startup_links":
        ;;      command => "string1",
        ;;      creates => [ "string2", "string3",
        ;;                   "string4", "string5",
        ;;                   "string6", "string7",
        ;;                   "string8" ],
        ;;      refreshonly => true,
        ;;    }
        (save-excursion
          (goto-char array-start)
          (forward-char 1)
          (re-search-forward "\\S-")
          (forward-char -1)
          (setq cur-indent (current-column))))
       (include-start
        (setq cur-indent include-start))
       ((and (looking-at "^\\s-*},?\\s-*$") block-indent)
        ;; This line contains a closing brace or a closing brace followed by a
        ;; comma and we're at the inner block, so we should indent it matching
        ;; the indentation of the opening brace of the block.
        (setq cur-indent block-indent))
       (t
        ;; Otherwise, we did not start on a block-ending-only line.
        (save-excursion
          ;; Iterate backwards until we find an indentation hint
          (while not-indented
            (forward-line -1)
            (cond
             ;; Comment lines are ignored unless we're at the start of the
             ;; buffer.
             ((puppet-comment-line-p)
              (if (bobp)
                  (setq not-indented nil)))

             ;; Brace or paren on a line by itself will already be indented to
             ;; the right level, so we can cheat and stop there.
             ((looking-at "^\\s-*[\)}]\\s-*")
              (setq cur-indent (current-indentation))
              (setq not-indented nil))

             ;; Brace (possibly followed by a comma) or paren not on a line by
             ;; itself will be indented one level too much, but don't catch
             ;; cases where the block is started and closed on the same line.
             ((looking-at "^[^\n\({]*[\)}],?\\s-*$")
              (setq cur-indent (- (current-indentation) puppet-indent-level))
              (setq not-indented nil))

             ;; Indent by one level more than the start of our block.  We lose
             ;; if there is more than one block opened and closed on the same
             ;; line but it's still unbalanced; hopefully people don't do that.
             ((looking-at "^.*{[^\n}]*$")
              (setq cur-indent (+ (current-indentation) puppet-indent-level))
              (setq not-indented nil))

             ;; Indent by one level if the line ends with an open paren.
             ((looking-at "^.*\(\\s-*$")
              (setq cur-indent (+ (current-indentation) puppet-indent-level))
              (setq not-indented nil))

             ;; Semicolon ends a block for a resource when multiple resources
             ;; are defined in the same block, but try not to get the case of
             ;; a complete resource on a single line wrong.
             ((looking-at "^\\([^'\":\n]\\|\"[^\n\"]*\"\\|'[^\n']*'\\)*;\\s-*$")
              (setq cur-indent (- (current-indentation) puppet-indent-level))
              (setq not-indented nil))

             ;; Indent an extra level after : since it introduces a resource.
             ((looking-at "^.*:\\s-*$")
              (setq cur-indent (+ (current-indentation) puppet-indent-level))
              (setq not-indented nil))

             ;; Start of buffer.
             ((bobp)
              (setq not-indented nil)))))

        ;; If this line contains only a closing paren, we should lose one
        ;; level of indentation.
        (if (looking-at "^\\s-*\)\\s-*$")
            (setq cur-indent (- cur-indent puppet-indent-level)))))

      ;; We've figured out the indentation, so do it.
      (if (and cur-indent (> cur-indent 0))
          (indent-line-to cur-indent)
        (indent-line-to 0)))))

(defvar puppet-font-lock-syntax-table
  (let* ((tbl (copy-syntax-table puppet-mode-syntax-table)))
    (modify-syntax-entry ?_ "w" tbl)
    tbl))

(defvar puppet-font-lock-keywords
  (list
   ;; defines, classes, and nodes
   '("^\\s *\\(class\\|define\\|node\\)\\s +\\([^( \t\n]+\\)"
     2 font-lock-function-name-face)
   ;; inheritence
   '("\\s +inherits\\s +\\([^( \t\n]+\\)"
     1 font-lock-function-name-face)
   ;; include
   '("\\(^\\|\\s +\\)include\\s +\\(\\([a-zA-Z0-9:_-]+\\(,[ \t\n]*\\)?\\)+\\)"
     2 font-lock-reference-face)
   ;; keywords
   (cons (concat
          "\\b\\(\\("
          (mapconcat
           'identity
           '("alert"
             "case"
             "class"
             "crit"
             "debug"
             "default"
             "define"
             "defined"
             "else"
             "emerg"
             "err"
             "fail"
             "false"
             "file"
             "filebucket"
             "generate"
             "if"
             "import"
             "include"
             "info"
             "inherits"
             "node"
             "notice"
             "realize"
             "search"
             "tag"
             "tagged"
             "template"
             "true"
             "warning"
             )
           "\\|")
          "\\)\\>\\)")
         1)
     ;; variables
     '("\\(^\\|[^_:.@$]\\)\\b\\(true\\|false\\)\\>"
       2 font-lock-variable-name-face)
     '("\\$[a-zA-Z0-9_:]+"
       0 font-lock-variable-name-face)
     ;; usage of types
     '("^\\s *\\([a-z][a-zA-Z0-9_:-]*\\)\\s +{"
       1 font-lock-type-face)
     ;; overrides and type references
     '("\\s +\\([A-Z][a-zA-Z0-9_:-]*\\)\\["
       1 font-lock-type-face)
     ;; general delimited string
     '("\\(^\\|[[ \t\n<+(,=]\\)\\(%[xrqQwW]?\\([^<[{(a-zA-Z0-9 \n]\\)[^\n\\\\]*\\(\\\\.[^\n\\\\]*\\)*\\(\\3\\)\\)"
       (2 font-lock-string-face)))
  "*Additional expressions to highlight in puppet mode.")

;;;###autoload
(defun puppet-mode ()
  "Major mode for editing puppet manifests.

The variable puppet-indent-level controls the amount of indentation.
\\{puppet-mode-map}"
  (interactive)
  (kill-all-local-variables)
  (use-local-map puppet-mode-map)
  (setq mode-name "Puppet")
  (setq major-mode 'puppet-mode)
  (set-syntax-table puppet-mode-syntax-table)
  (set (make-local-variable 'local-abbrev-table) puppet-mode-abbrev-table)
  (set (make-local-variable 'comment-start) "# ")
  (set (make-local-variable 'comment-start-skip) "#+ *")
  (set (make-local-variable 'comment-use-syntax) t)
  (set (make-local-variable 'comment-end) "")
  (set (make-local-variable 'comment-auto-fill-only-comments) t)
  (set (make-local-variable 'comment-column) puppet-comment-column)
  (set (make-local-variable 'indent-line-function) 'puppet-indent-line)
  (set (make-local-variable 'indent-tabs-mode) puppet-indent-tabs-mode)
  (set (make-local-variable 'require-final-newline) t)
  (set (make-local-variable 'paragraph-ignore-fill-prefix) t)
  (set (make-local-variable 'paragraph-start) "\f\\|[   ]*$\\|#$")
  (set (make-local-variable 'paragraph-separate) "\\([  \f]*\\|#\\)$")
  (or (boundp 'font-lock-variable-name-face)
      (setq font-lock-variable-name-face font-lock-type-face))
  (set (make-local-variable 'font-lock-keywords) puppet-font-lock-keywords)
  (set (make-local-variable 'font-lock-multiline) t)
  (set (make-local-variable 'font-lock-defaults)
       '((puppet-font-lock-keywords) nil nil))
  (set (make-local-variable 'font-lock-syntax-table)
       puppet-font-lock-syntax-table)
  (run-hooks 'puppet-mode-hook))

(provide 'puppet-mode)

;;
;; Setup puppet-mode for autoloading
;;
(autoload 'puppet-mode "puppet-mode" "Major mode for editing puppet manifests")

(add-to-list 'auto-mode-alist '("\\.pp$" . puppet-mode))
#+END_SRC
* Company
** TODO evtl. company enter key verbessern
https://emacs.stackexchange.com/questions/13286/how-can-i-stop-the-enter-key-from-triggering-a-completion-in-company-mode

#+BEGIN_SRC emacs-lisp
  (use-package company
    :diminish
    :custom
      (company-begin-commands '(self-insert-command))
      (company-idle-delay .1)
      (company-minimum-prefix-length 2)
      (company-show-numbers t)
      (company-tooltip-align-annotations 't)
      (company-tooltip-limit 20)
      (company-echo-delay 0)
      (company-dabbrev-downcase nil)
    :config
      (use-package company-go
        :after company
        :diminish)

      (general-define-key
        :states '(insert motion)
        "C-n" 'company-select-next-or-abort
        "C-p" 'company-select-previous-or-abort))

  (add-hook 'go-mode-hook (lambda ()
                            (set (make-local-variable 'company-backends) '(company-go))
                            (company-mode)))
#+END_SRC
* Yasnippets
#+BEGIN_SRC emacs-lisp
  (use-package yasnippet
    :commands (yas-reload-all yas-minor-mode)
    :init
    (add-hook 'c++-mode-hook (lambda() (yas-reload-all)(yas-minor-mode)))
    (add-hook 'go-mode-hook (lambda() (yas-reload-all)(yas-minor-mode)))
    :config
      (use-package yasnippet-snippets))
      (use-package ivy-yasnippet
        :config
        (general-define-key
          :states '(insert motion)
          "C-c y" 'ivy-yasnippet))
#+END_SRC
** CANCELLED company/yasnippets                                                    :CANCELLED:
Look at this if needed.
#+BEGIN_SRC emacs-lisp
  ;; https://emacs.stackexchange.com/questions/10431/get-company-to-show-suggestions-for-yasnippet-names
  ;; Add yasnippet support for all company backends
  ;; https://github.com/syl20bnr/spacemacs/pull/179
  (defvar company-mode/enable-yas t
    "Enable yasnippet for all backends.")

  (defun company-mode/backend-with-yas (backend)
    (if (or (not company-mode/enable-yas) (and (listp backend) (member 'company-yasnippet backend)))
        backend
      (append (if (consp backend) backend (list backend))
              '(:with company-yasnippet))))

  (setq company-backends (mapcar #'company-mode/backend-with-yas company-backends))
#+END_SRC
* Magit
#+BEGIN_SRC emacs-lisp
  (use-package magit
    :init
    (general-define-key
      :states '(normal visual insert emacs)
      :prefix "SPC"
      :non-normal-prefix "M-SPC"
      "g"  '(:ignore t :which-key "Magit")
      "gs" '(magit-status :which-key "Status")
      "gp" '(magit-push-other :which-key "Push")
      "gl" '(magit-log :which-key "Log"))
    :config
      (require 'evil-magit))

  (use-package evil-magit
    :after magit)
#+END_SRC
* Engine
#+BEGIN_SRC emacs-lisp
  (use-package engine-mode
    :config
    (progn
      (defengine google "http://google.de/search?q=%s" :keybinding "g")
      (defengine mail "https://mail.google.com/mail/u/0/#search/%s" :keybinding "m")
      (defengine jira "https://jira.payone-office.de/issues/?jql=text ~ \"\"%s\"\" ORDER BY created DESC" :keybinding "j")
      (engine-mode))

    (general-define-key
      :states '(normal visual insert emacs)
      :prefix "SPC"
      :non-normal-prefix "M-SPC"
      "se"  '(:ignore t :which-key "Engine")
      "seg" '(engine/search-google "goole" :which-key "Google")
      "sem" '(engine/search-mail "mail" :which-key "Mail")
      "sej" '(engine/search-jira "jira" :which-key "Jira")))
#+END_SRC
* Tramp
https://rentes.github.io/emacs/windows/ssh/2016/08/25/Editing-Remote-Files-With-Emacs-Under-Windows/

#+BEGIN_EXAMPLE
  /plink:user@host:
  /plink:user@host|sudo:host:
#+END_EXAMPLE

With tramp-default-proxies-alist:
https://emacs.stackexchange.com/questions/26560/bookmarking-remote-directories-trampsudo
#+BEGIN_EXAMPLE
  /sudo:hugo.rivered.de:
#+END_EXAMPLE

#+BEGIN_SRC emacs-lisp
  (use-package tramp
    :init
      (setq tramp-persistency-file-name nil)
    :config
      (when (my-system-is-mypc)
        (set-default 'tramp-auto-save-directory "C:\\Users\\NOBODY\\AppData\\Local\\Temp")
        (set-default 'tramp-default-method "plink"))
      (when (my-system-is-myworkpc)
        (set-default 'tramp-auto-save-directory "C:\\Users\\chris.keschnat\\AppData\\Local\\Temp")
        (set-default 'tramp-default-method "plink"))
      (add-to-list 'tramp-default-proxies-alist
                   '("\\`hugo.rivered.de\\'" "\\`root\\'" "/plink:ck@%h:"))
      (add-to-list 'tramp-default-proxies-alist
                   '("\\`moon.rivered.de\\'" "\\`root\\'" "/plink:ck@%h:"))

      (use-package counsel-tramp)

      (add-hook 'counsel-tramp-pre-command-hook '(lambda ()
                                           (projectile-mode 0)))
      (add-hook 'counsel-tramp-quit-hook '(lambda ()
                                    (projectile-mode 1)))

      (eval-after-load 'tramp '(setenv "SHELL" "/bin/bash"))

      (setq counsel-tramp-custom-connections '(/plink:hugo.rivered.de|sudo:ck@hugo.rivered.de:/ /plink:moon.rivered.de|sudo:ck@moon.rivered.de:/)))

#+END_SRC
* CANCELLED Elfeed                                                :CANCELLED:
CLOSED: [2018-12-09 Sun 00:26]
#+BEGIN_SRC emacs-lisp
  (use-package elfeed
    :config
    (add-to-list 'evil-emacs-state-modes 'elfeed-search-mode)
    (add-to-list 'evil-emacs-state-modes 'elfeed-show-mode)

    (setq elfeed-feeds
          '("http://nullprogram.com/feed/"
            "http://planet.emacsen.org/atom.xml"
            "https://hnrss.org/frontpage"))

    (use-package elfeed-goodies
      :config
        (require 'elfeed-goodies)
        (elfeed-goodies/setup)))
#+END_SRC
